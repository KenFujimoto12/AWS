## オートドレイニングについて
デフォルトではAutoScalingでインスタンスが削除される場合、そのインスタンス上で起動しているタスクは一緒に削除されてしまう。
この削除タイミングによってはユーザー側に影響が出たり、ダウンタイムが発生してしまう恐れがある。

そのため、基本的にはECSのインスタンスを停止する際にドレイニングは必須。
削除予定のインスタンスに対してドレイニングを有効にすると、既に起動しているタスクは他のインスタンスへ移動するかのような振る舞いをする。

![Draining](https://user-images.githubusercontent.com/37132477/103963102-d6c5cc80-519b-11eb-8bd0-410418431ef8.png "Draining")

![Drainingなし](hhttps://user-images.githubusercontent.com/37132477/103963155-ee9d5080-519b-11eb-86cd-5d643ebca4db.png "Drainingなし")


## Auto Scalingの設定
AutoScalingGroupの設定から「通知」タブを押し、インスタンスの終了イベント時に、先ほど作成されたSNSを指定する。
これでインスタンスが終了する際にSNSへの通知が送られることでLambdaが起動し、削除対象のインスタンスをドレイニング状態にする。


## 注意点
この設定はAutoScalingグループが複数ある場合、その分だけ作成する必要がある
また、ドレイニングによってタスクが移動する際に、移動先でポートが使用されている場合や、
リソースが足りないなどの要因でタスクを閉じることができない場合には15分後に強制的に終了される。
